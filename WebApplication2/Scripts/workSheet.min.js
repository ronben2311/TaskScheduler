(function(){app.controller("myCtrl",function(n,t,i,r){function f(){t.GetAllCustomers().then(function(t){t.data&&(n.customerList=t.data);console.log("CallGetAllCustomers res : ",t.data)},u)}n.userLogInInfo=r.get();var u=function(n){console.log("err : ",n)};f();n.customerList=null;n.projectList=null;n.projectListAddModal=null;n.taskList=null;n.taskListAddModal=null;n.currentPage=1;n.pageNum=0;n.taskInput="";n.chosenColumn="name";n.orderBy=" ascending";n.orderByObj={columnName:"taskName",orderBy:" ascending"};n.showLoadingData=!0;n.taskSearchObj={projectId:"",pageSize:5,pageNumber:n.pageNum,taskPartialName:n.taskInput,chosenColumn:n.orderByObj.columnName,orderBy:" ascending"};n.retWorkSheetList=null;n.GetCustomersProjects=function(i,r){t.GetCustomersProjects(i.id).then(function(t){console.log("GetCustomersProjects res: ",t.data);r==!0?(n.projectListAddModal=t.data,n.objToAdd.project=n.projectListAddModal[0]):n.projectList=t.data},u)};n.GetTasksByProject=function(i,r){t.GetTasksByProjectId(i.id).then(function(t){r==!0?(n.taskListAddModal=t.data,n.objToAdd.task=n.taskListAddModal[0]):n.taskList=t.data},u)};n.WorkSheetByProjectId=function(i,r,f){console.log("iProjectId: ",i);var e={employeeId:n.userLogInInfo.userId,projectId:i,pageSize:5,pageNumber:r,taskPartialName:n.taskInput,chosenColumn:f,orderBy:" ascending"};t.WorkSheetByProjectId(e).then(function(t){n.workSheetList=t.data.retWorkSheetList;n.totalCount=t.data.totalCount},u)};n.OpenEditModal=function(i){n.objToEdit={sheetId:i.id,customerName:i.customerName,projectName:i.projectName,date:null,newStartHour:null,newEndHour:null,newComment:null,taskId:i.taskId};n.objToEdit.date=new Date(i.dateYear,i.dateMonth,i.dateDay);var r=i.startHour.substring(0,2),f=i.startHour.substring(3,5);n.objToEdit.newStartHour=new Date(i.dateYear,i.dateMonth,i.dateDay,r,f,0);r=i.endHour.substring(0,2);f=i.endHour.substring(3,5);n.objToEdit.newEndHour=new Date(i.dateYear,i.dateMonth,i.dateDay,r,f,0);n.objToEdit.newComment=i.comment;t.GetTasksByProjectId(i.projectId).then(function(t){n.taskList=t.data;$("#myModal").modal()},u)};n.OpenNewwSheetModal=function(){n.objToAdd={customer:null,project:null,task:null,date:null,startHour:null,endHour:null,comment:null};n.objToAdd.customer=null;n.objToAdd.date=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate());n.objToAdd.startHour=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),"09","00",0);n.objToAdd.endHour=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),"17","00",0);$("#newSheetModal").modal()};n.CalcHourDiff=function(n,t){if(n&&t){var u=moment(n,"YYYY-MM-DD HH:mm"),f=moment(t,"YYYY-MM-DD HH:mm"),i=parseInt(f.diff(u,"minutes")/60),r=f.diff(u,"minutes")%60;return i=Math.abs(i),r=Math.abs(r),i<9&&(i="0"+i),r<9&&(r="0"+r),i+":"+r}};n.SaveSheet=function(i){var r=_.find(n.workSheetList,function(n){return n.id==i.sheetId});t.SaveSheet(i).then(function(){n.WorkSheetByProjectId(r.projectId,0,"taskName");$("#myModal").modal("hide")},u)};n.AddWorkSheet=function(i){var r={employeeId:n.userLogInInfo.userId,taskId:i.task.id,date:i.date,newStartHour:i.startHour,newEndHour:i.endHour,newComment:i.comment};t.AddWorkSheet(r).then(function(){$("#newSheetModal").modal("hide")},u)};n.DeleteSheet=function(i){console.log("iSheetId :",i);t.DeleteSheet(i).then(function(t){n.workSheetList=_.reject(n.workSheetList,function(n){return n.id==i});n.taskList=t.data;$("#myModal").modal("hide")},u)}})})();